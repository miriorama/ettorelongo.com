class Util{static mapRange(t,e,s,a,i){return a+(t-e)*(i-a)/(s-e)}static exp(t,e=3){return Math.pow(t,e)}static random(t=0,e=1){return Math.random()*(e-t)+t}}class MatrixVisualizer{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.cols=0,this.rows=0,this.cellWidth=0,this.cellHeight=0,this.lineLength=0,this.lines=[],this.waves=[],this.waveSpeed=800,this.waveThickness=100,this.waveLifetime=8e3,this.mouseX=0,this.mouseY=0,this.hasMouse=!1,this.chaosAmount=.5,this.currentPatternName="vertical",this.sections=Array.from(document.querySelectorAll(".section")),this.resizeCanvas(),window.addEventListener("resize",(()=>this.resizeCanvas())),this.bindEvents(),this.applyVerticalPattern(),this.animate()}hslToHex(t,e,s,a=1){e/=100,s/=100;const i=(1-Math.abs(2*s-1))*e,n=i*(1-Math.abs(t/60%2-1)),o=s-i/2;let h=0,l=0,r=0;0<=t&&t<60?(h=i,l=n,r=0):60<=t&&t<120?(h=n,l=i,r=0):120<=t&&t<180?(h=0,l=i,r=n):180<=t&&t<240?(h=0,l=n,r=i):240<=t&&t<300?(h=n,l=0,r=i):(h=i,l=0,r=n),h=Math.round(255*(h+o)),l=Math.round(255*(l+o)),r=Math.round(255*(r+o));const c=Math.round(255*a),g=t=>t.toString(16).padStart(2,"0");return`#${g(h)}${g(l)}${g(r)}${g(c)}`}hexToRgb(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:255,g:255,b:255}}hexToRgba(t){if(3===(t=t.replace("#","").trim()).length?t=t.split("").map((t=>t+t)).join("")+"ff":4===t.length&&(t=t.split("").map((t=>t+t)).join("")),6===t.length&&(t+="ff"),8!==t.length)return{r:255,g:255,b:255,a:255};return{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16),a:parseInt(t.substring(6,8),16)}}rgbToHex(t,e,s){return"#"+((1<<24)+(t<<16)+(e<<8)+s).toString(16).slice(1)}rgbaToHex(t,e,s,a=255){const i=t=>t.toString(16).padStart(2,"0");return"#"+i(t)+i(e)+i(s)+i(a)}lerpColor(t,e,s=1){const a=this.hexToRgba(t),i=this.hexToRgba(e),n=Math.round(a.r+(i.r-a.r)*s),o=Math.round(a.g+(i.g-a.g)*s),h=Math.round(a.b+(i.b-a.b)*s),l=Math.round(a.a+(i.a-a.a)*s);return this.rgbaToHex(n,o,h,l)}resizeCanvas(){this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight,this.initLines()}initLines(){this.cols=Math.floor(this.canvas.width/30),console.log(this.cols),this.rows=Math.floor(this.canvas.height/30),this.cellWidth=this.canvas.width/this.cols,this.cellHeight=this.canvas.height/this.rows,this.lineLength=.6*Math.min(this.cellWidth,this.cellHeight),this.lines=[];for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++){const s=e*this.cellWidth+this.cellWidth/2,a=t*this.cellHeight+this.cellHeight/2;this.lines.push({x:s,y:a,row:t,col:e,angle:0,targetAngle:0,baseAngle:Math.PI/2,randomAngle:Math.random()*Math.PI*2,color:"#d3e0d3",targetColor:"#d3e0d3",baseColor:"#d3e0d3"})}}bindEvents(){this.canvas.addEventListener("mousemove",(t=>{const e=this.canvas.getBoundingClientRect();this.mouseX=t.clientX-e.left,this.mouseY=t.clientY-e.top,this.hasMouse=!0})),this.canvas.addEventListener("mouseleave",(()=>{this.hasMouse=!1}));const t=document.getElementById("chaosSlider"),e=document.getElementById("chaosFill");if(t&&e){let s=document.querySelectorAll(".k");const a=()=>{const a=t.value/t.max;e.style.width=100*a+"%";let i=Util.exp(a);this.chaosAmount=parseFloat(i),console.log(this.chaosAmount),s.forEach((t=>{let e=Util.mapRange(i*Util.random(-1,1),-1,1,-10,10),s=Util.mapRange(i*Util.random(-1,1),-1,1,.5,1.5),a=Util.mapRange(i*Util.random(-1,1),-1,1,.5,1.5),n=Util.mapRange(i*Util.random(-1,1),-1,1,.5,1.5);t.style.transform=`rotate(${e}deg) scaleZ(${n}) scaleX(${s}) scaleY(${a})`}))};a(),t.addEventListener("input",a)}window.addEventListener("scroll",(()=>this.onScroll())),this.onScroll(),this.canvas.addEventListener("click",(t=>{const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,a=t.clientY-e.top;this.waves.push({x:s,y:a,start:performance.now()}),console.log(this.waves)}))}onScroll(){const t=-.01*window.scrollY;this.canvas.style.transform=`translateY(${t}px)`;const e=window.innerHeight/2;let s=null,a=1/0;if(this.sections.forEach((t=>{const i=t.getBoundingClientRect(),n=i.top+i.height/2,o=Math.abs(n-e);o<a&&(a=o,s=t)})),s){const t=s.dataset.pattern||"vertical";t!==this.currentPatternName&&(this.currentPatternName=t)}}applyPattern(t){console.log(t),this.currentPatternName=t,"vertical"===t?this.applyVerticalPattern():"wave"===t?this.applyWavePattern():"spiral"===t?this.applySpiralPattern():"longo"===t&&this.applyLongoPattern()}getLetterMap(){return{A:[[0,1,1,0],[1,0,0,1],[1,1,1,1],[1,0,0,1],[1,0,0,1]],B:[[1,1,1,0],[1,0,0,1],[1,1,1,0],[1,0,0,1],[1,1,1,0]],C:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[1,0,0,0,1],[0,1,1,1,0]],D:[[1,1,1,0],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,1,1,0]],E:[[1,1,1,1],[1,0,0,0],[1,1,1,0],[1,0,0,0],[1,1,1,1]],F:[[1,1,1,1],[1,0,0,0],[1,1,1,0],[1,0,0,0],[1,0,0,0]],G:[[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,0],[1,0,1,1,1],[0,1,1,1,1]],H:[[1,0,0,1],[1,0,0,1],[1,1,1,1],[1,0,0,1],[1,0,0,1]],I:[[1,1,1],[0,1,0],[0,1,0],[0,1,0],[1,1,1]],J:[[0,1,1,1],[0,0,1,0],[0,0,1,0],[1,0,1,0],[0,1,0,0]],K:[[1,0,0,1],[1,0,1,0],[1,1,0,0],[1,0,1,0],[1,0,0,1]],L:[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,1,1,1]],M:[[1,0,0,0,1],[1,1,0,1,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,0,0,1]],N:[[1,0,0,1],[1,1,0,1],[1,0,1,1],[1,0,0,1],[1,0,0,1]],O:[[0,1,1,0],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,1,1,0]],P:[[1,1,1,0],[1,0,0,1],[1,1,1,0],[1,0,0,0],[1,0,0,0]],Q:[[0,1,1,0],[1,0,0,1],[1,0,0,1],[1,0,1,1],[0,1,1,1]],R:[[1,1,1,0],[1,0,0,1],[1,1,1,0],[1,0,1,0],[1,0,0,1]],S:[[0,1,1,1],[1,0,0,0],[0,1,1,0],[0,0,0,1],[1,1,1,0]],T:[[1,1,1],[0,1,0],[0,1,0],[0,1,0],[0,1,0]],U:[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,1,1,0]],V:[[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,1,0,1,0],[0,0,1,0,0]],W:[[1,0,0,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,1,0,1,1],[1,0,0,0,1]],X:[[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1]],Y:[[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],Z:[[1,1,1,1,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,1,1,1,1]]}}applyVerticalPattern(){const t=Math.PI/2;this.hslToHex(120,12,90,1);this.lines.forEach((e=>{e.baseAngle=t,e.baseColor="#d3e0d3"}))}applyWavePattern(){Math.PI;this.lines.forEach((t=>{const e=t.col/this.cols,s=t.row/this.rows,a=.8*Math.sin(e*Math.PI*2+s*Math.PI),i=e,n=this.hslToHex(120,12,90,i);t.baseAngle=a,t.baseColor=n}))}applySpiralPattern(){const t=this.cols/2,e=this.rows/2;this.lines.forEach((s=>{const a=s.col-t,i=s.row-e,n=Math.sqrt(a*a+i*i)+1e-4,o=Math.atan2(i,a)+.25*n,h=15*n%360,l=Math.abs(h/360),r=this.hslToHex(120,12,90,l);s.baseAngle=o,s.baseColor=r}))}applyLongoPattern(){if(this.applyVerticalPattern(),this.canvas.width<1440)return;const t=this.getLetterMap(),e="#8075ff",s=e=>{let s=0;for(const a of e.toUpperCase()){if(" "===a){s+=3;continue}const e=t[a];e&&(s+=e[0].length+2)}return Math.max(s-2,0)},a="CONTACT",i=Math.max(Math.floor((this.rows-12)/2),0),n=i+5+2,o=Math.max(Math.floor((this.cols-s(a))/2),0),h=Math.max(Math.floor((this.cols-s("ME"))/2),0),l=(s,a,i)=>{let n=i;for(const i of s.toUpperCase()){if(" "===i){n+=3;continue}const s=t[i];if(s){for(let t=0;t<s.length;t++)for(let i=0;i<s[t].length;i++)if(1===s[t][i]){const s=a+t,o=n+i;if(s>=0&&s<this.rows&&o>=0&&o<this.cols){const t=s*this.cols+o,a=this.lines[t];a.baseColor=e,a.targetColor=e;Math.random(),this.chaosAmount;a.baseAngle=Math.PI/2.2,a.targetAngle=Math.PI/1.8}}n+=s[0].length+2}}};l(a,i,o),l("ME",n,h)}applyMouseInfluence(){if(0==this.mouseX&&0==this.mouseY)return;const t=Math.floor(this.mouseX/this.cellWidth),e=Math.floor(this.mouseY/this.cellHeight);for(let s=e-12;s<=e+12;s++)for(let a=t-12;a<=t+12;a++)if(s>=0&&s<this.rows&&a>=0&&a<this.cols){const i=s*this.cols+a,n=this.lines[i],o=s-e,h=a-t,l=Math.sqrt(o*o+h*h);if(l<=6){const t=1-l/6,e=this.mouseX-n.x,s=this.mouseY-n.y,a=Math.sqrt(e*e+s*s),i=Math.atan2(s,e);n.targetAngle=n.baseAngle+(i-n.baseAngle)*t;const o=6*Math.max(this.cellWidth,this.cellHeight),h=Math.min(a,o)/o,r=Util.mapRange(h,0,1,245,120);this.hslToHex(r,70,60,1);n.targetColor=this.lerpColor(n.baseColor,"#8075ff",t)}}}applyWaves(t){for(let e=this.waves.length-1;e>=0;e--)t-this.waves[e].start>this.waveLifetime&&this.waves.splice(e,1);this.waves.forEach((e=>{const s=(t-e.start)/1e3*this.waveSpeed;this.lines.forEach((t=>{const a=t.x-e.x,i=t.y-e.y,n=Math.sqrt(a*a+i*i),o=Math.abs(n-s);if(o<this.waveThickness){const e=1-o/this.waveThickness,n=Math.atan2(i,a)+Math.PI/2;t.targetAngle=t.targetAngle+(n-t.targetAngle)*e;const h=s/4%360;this.hslToHex(h,80,70);t.targetColor=this.lerpColor(t.baseColor,"#8075ff",1)}}))}))}updateLine(t){const e=this.chaosAmount,s=t.baseAngle,a=t.randomAngle;let i;i="vertical"==this.currentPatternName?s+(a-s)*e:s;let n=t.baseColor;t.targetAngle=i,t.targetColor=n,t.angle+=.1*(t.targetAngle-t.angle),t.color=this.lerpColor(t.color,t.targetColor,.1)}drawLine(t){const e=this.ctx;e.save(),e.translate(t.x,t.y),e.rotate(t.angle),e.strokeStyle=t.color,e.lineWidth=3,e.lineCap="round",e.beginPath(),e.moveTo(-this.lineLength/2,0),e.lineTo(this.lineLength/2,0),e.stroke(),e.restore()}animate(){requestAnimationFrame((()=>this.animate()));const t=this.ctx;t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle="#CAD5CA",t.fillRect(0,0,this.canvas.width,this.canvas.height);const e=performance.now();this.applyPattern(this.currentPatternName),this.applyMouseInfluence(e),this.applyWaves(e),this.lines.forEach((t=>{this.updateLine(t),this.drawLine(t)}))}}const canvas=document.getElementById("matrixCanvas"),visualizer=new MatrixVisualizer(canvas);