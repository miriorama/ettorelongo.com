class Util{static mapRange(t,e,s,a,o){return a+(t-e)*(o-a)/(s-e)}static mapToDeg(t){return 45*Math.max(-1,Math.min(1,t))}static exp(t,e=3){return Math.pow(t,e)}static random(t=0,e=1){return Math.random()*(e-t)+t}static mapToHex(t){return Math.round(255*t).toString(16).padStart(2,"0")}static hslToHex(t,e,s,a=1){e/=100,s/=100;const o=(1-Math.abs(2*s-1))*e,i=o*(1-Math.abs(t/60%2-1)),n=s-o/2;let l=0,h=0,r=0;0<=t&&t<60?(l=o,h=i,r=0):60<=t&&t<120?(l=i,h=o,r=0):120<=t&&t<180?(l=0,h=o,r=i):180<=t&&t<240?(l=0,h=i,r=o):240<=t&&t<300?(l=i,h=0,r=o):(l=o,h=0,r=i),l=Math.round(255*(l+n)),h=Math.round(255*(h+n)),r=Math.round(255*(r+n));const c=Math.round(255*a),g=t=>t.toString(16).padStart(2,"0");return`#${g(l)}${g(h)}${g(r)}${g(c)}`}static hexToRgba(t){if(3===(t=t.replace("#","").trim()).length?t=t.split("").map((t=>t+t)).join("")+"ff":4===t.length&&(t=t.split("").map((t=>t+t)).join("")),6===t.length&&(t+="ff"),8!==t.length)return{r:255,g:255,b:255,a:255};return{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16),a:parseInt(t.substring(6,8),16)}}static rgbaToHex(t,e,s,a=255){const o=t=>t.toString(16).padStart(2,"0");return"#"+o(t)+o(e)+o(s)+o(a)}static lerpColor(t,e,s=1){const a=Util.hexToRgba(t),o=Util.hexToRgba(e),i=Math.round(a.r+(o.r-a.r)*s),n=Math.round(a.g+(o.g-a.g)*s),l=Math.round(a.b+(o.b-a.b)*s),h=Math.round(a.a+(o.a-a.a)*s);return Util.rgbaToHex(i,n,l,h)}}class Ui{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.cols=0,this.rows=0,this.cellWidth=0,this.cellHeight=0,this.lineLength=0,this.lines=[],this.waves=[],this.backgroundColor="#675867",this.lightColor="#949194",this.accentColor="#CAD5CA",this.waveSpeed=800,this.waveThickness=100,this.waveLifetime=8e3,this.mouseX=0,this.mouseY=0,this.hasMouse=!1,this.debug=document.querySelector(".debug"),this.chaosAmount=0,this.currentPatternName="vertical",this.lastPatternApplied="",this.sections=Array.from(document.querySelectorAll(".section")),this.resizeCanvas(),window.addEventListener("resize",(()=>this.resizeCanvas())),this.bindEvents(),this.applyVerticalPattern(),this.animate()}resizeCanvas(){this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight,this.initLines(),this.applyPattern(this.currentPatternName)}initLines(){this.cols=Math.floor(this.canvas.width/30),this.rows=Math.floor(this.canvas.height/30),this.cellWidth=this.canvas.width/this.cols,this.cellHeight=this.canvas.height/this.rows,this.lineLength=.6*Math.min(this.cellWidth,this.cellHeight),this.lines=[];for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++){const s=e*this.cellWidth+this.cellWidth/2,a=t*this.cellHeight+this.cellHeight/2;this.lines.push({x:s,y:a,row:t,col:e,angle:0,targetAngle:0,baseAngle:Math.PI/2,randomAngle:Math.random()*(90*Math.PI/180),color:this.backgroundColor,targetColor:this.lightColor,baseColor:this.backgroundColor})}}bindEvents(){window.addEventListener("mousemove",(t=>{const e=this.canvas.getBoundingClientRect();this.mouseX=t.clientX-e.left,this.mouseY=t.clientY-e.top,this.hasMouse=!0})),window.addEventListener("mouseleave",(()=>{this.hasMouse=!1})),window.addEventListener("scroll",(()=>this.onScroll())),this.onScroll();window;window.addEventListener("click",(t=>{const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,a=t.clientY-e.top;this.waves.push({x:s,y:a,start:performance.now()})}),{passive:!1})}onScroll(){const t=-.01*window.scrollY,e=Math.max(document.documentElement.scrollHeight-window.innerHeight,1),s=2*Math.min(1,Math.max(0,window.scrollY/e));this.canvas.style.transform=`translateY(${t}px) rotate(${s}deg)`;const a=window.innerHeight/2;let o=null,i=1/0;if(this.sections.forEach((t=>{const e=t.getBoundingClientRect(),s=e.top+e.height/2,n=Math.abs(s-a);n<i&&(i=n,o=t)})),o){const t=o.dataset.pattern||"vertical";t!==this.currentPatternName&&(this.currentPatternName=t)}}applyPattern(t){this.currentPatternName=t,"vertical"===t?this.applyVerticalPattern():"wave"===t?this.applyWavePattern():"spiral"===t&&this.applySpiralPattern()}applyVerticalPattern(){this.lines.forEach((t=>{t.baseAngle=Math.PI/2,t.baseColor=this.lightColor+Util.mapToHex(.2)}))}applyWavePattern(){const t=this.cols/2,e=this.rows/2,s=Math.sqrt(t*t+e*e)||1;this.lines.forEach((a=>{const o=a.col/this.cols,i=a.row/this.rows,n=.8*Math.sin(o*Math.PI*2+i*Math.PI),l=a.col-t,h=a.row-e,r=.5*(1-Math.min(1,Math.max(0,Math.sqrt(l*l+h*h)/s))),c=this.lightColor+Util.mapToHex(r);a.baseAngle=n,a.baseColor=c}))}applySpiralPattern(){const t=this.cols/2,e=this.rows/2,s=Math.sqrt(t*t+e*e)||1;this.lines.forEach((a=>{const o=a.col-t,i=a.row-e,n=Math.sqrt(o*o+i*i)+1e-4,l=Math.atan2(i,o)+.25*n,h=.5*Math.min(1,Math.max(0,n/s)),r=this.lightColor+Util.mapToHex(h);a.baseAngle=l,a.baseColor=r}))}applyMouseInfluence(){if(0==this.mouseX&&0==this.mouseY)return;const t=Math.floor(this.mouseX/this.cellWidth),e=Math.floor(this.mouseY/this.cellHeight);for(let s=e-12;s<=e+12;s++)for(let a=t-12;a<=t+12;a++)if(s>=0&&s<this.rows&&a>=0&&a<this.cols){const o=s*this.cols+a,i=this.lines[o],n=s-e,l=a-t,h=Math.sqrt(n*n+l*l);if(h<=6){const t=1-h/6,e=this.mouseX-i.x,s=this.mouseY-i.y,a=Math.sqrt(e*e+s*s),o=Math.atan2(s,e);i.targetAngle=i.baseAngle+(o-i.baseAngle)*t;const n=6*Math.max(this.cellWidth,this.cellHeight),l=Math.min(a,n)/n,r=Util.mapRange(l,0,1,245,120);Util.hslToHex(r,70,60,1);i.targetColor=Util.lerpColor(i.color,this.accentColor,t)}}}applyWaves(t){for(let e=this.waves.length-1;e>=0;e--)t-this.waves[e].start>this.waveLifetime&&this.waves.splice(e,1);this.waves.forEach((e=>{const s=(t-e.start)/1e3*this.waveSpeed;this.lines.forEach((t=>{const a=t.x-e.x,o=t.y-e.y,i=Math.sqrt(a*a+o*o),n=Math.abs(i-s);if(n<this.waveThickness){const e=1-n/this.waveThickness,i=Math.atan2(o,a)+Math.PI/2;t.targetAngle=t.targetAngle+(i-t.targetAngle)*e;const l=s/4%360;Util.hslToHex(l,80,70);t.targetColor=Util.lerpColor(t.color,this.accentColor,1)}}))}))}updateLine(t){t.angle+=.1*(t.targetAngle-t.angle),t.color=Util.lerpColor(t.color,t.targetColor,.1);const e=t.randomAngle*this.chaosAmount;t.targetAngle=t.baseAngle+e,t.targetColor=t.baseColor;const s=this.ctx;s.save(),s.translate(t.x,t.y),s.rotate(t.angle),s.strokeStyle=t.color,s.lineWidth=3,s.lineCap="round",s.beginPath(),s.moveTo(-this.lineLength/2,0),s.lineTo(this.lineLength/2,0),s.stroke(),s.restore()}animate(){requestAnimationFrame((()=>this.animate()));const t=this.ctx;t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle=this.backgroundColor,t.fillRect(0,0,this.canvas.width,this.canvas.height);const e=performance.now();this.currentPatternName!==this.lastPatternApplied&&(this.applyPattern(this.currentPatternName),this.lastPatternApplied=this.currentPatternName),this.applyMouseInfluence(e),this.applyWaves(e),this.lines.forEach((t=>{this.updateLine(t)}))}}class Longo{static init(){Longo.sectionChaosSeeds=[],Longo.caosableChaosSeeds=[];const t=document.getElementById("matrixCanvas"),e=document.getElementById("chaosSlider");Longo.visualizer=new Ui(t),Longo.visualizer.chaosAmount=e.value,Longo.sliderChange()}static sliderChange(){Longo.updateSliderUI()}static initChaosSeeds(t=!1,e=null,s=null){const a=e||document.querySelectorAll(".section"),o=s||document.querySelectorAll(".k");!t&&Longo.sectionChaosSeeds&&Longo.sectionChaosSeeds.length===a.length||(Longo.sectionChaosSeeds=Array.from(a).map((()=>({rotateSeed:Util.random(-1,1),scaleSeed:Util.random(0,1)})))),!t&&Longo.caosableChaosSeeds&&Longo.caosableChaosSeeds.length===o.length||(Longo.caosableChaosSeeds=Array.from(o).map((()=>({rotateSeed:Util.random(-1,1),scaleXSeed:Util.random(-1,1),scaleYSeed:Util.random(-1,1),scaleZSeed:Util.random(-1,1)}))))}static updateSliderUI(){const t=document.getElementById("chaosSlider"),e=document.getElementById("chaosFill");let s=document.querySelectorAll(".k"),a=document.querySelectorAll(".section");const o=t.value/t.max;e.style.width=100*o+"%";let i=Util.exp(o,5);Longo.visualizer.chaosAmount=parseFloat(i),Longo.initChaosSeeds(0===o,a,s),a.forEach(((t,e)=>{const s=Longo.sectionChaosSeeds[e];let a=Util.mapRange(i*s.scaleSeed,0,1,1,2),o=Util.mapToDeg(i*s.rotateSeed);t.style.transform=`rotate(${o}deg) scale(${a})`})),s.forEach(((t,e)=>{const s=Longo.caosableChaosSeeds[e];let a=Util.mapToDeg(i*s.rotateSeed),o=Util.mapRange(i*s.scaleXSeed,-1,1,.5,1.5),n=Util.mapRange(i*s.scaleYSeed,-1,1,.5,1.5),l=Util.mapRange(i*s.scaleZSeed,-1,1,.5,1.5);t.style.transform=`rotate(${a}deg) scaleZ(${l}) scaleX(${o}) scaleY(${n})`}))}}Longo.init();